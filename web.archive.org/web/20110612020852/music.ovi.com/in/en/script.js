var database = {
    "top": [
      
        {
            "title": "Achacho",
            "artist": "Kharesma Ravichandran",
            "album": "Aranmanai 4",
            "language": "Tamil",
            "cover": "https://coverartarchive.org/release/5950a826-b631-49e1-957a-dd0644712efc/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Achacho.mp3"
        },
        {
            "title": "Faded Love (Alan Walker vs. Selena Gomez)",
            "artist": "AW",
            "album": "Unknown Album",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/undefined/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Alan Walker Faded.mp3"
        },
        {
            "title": "Azhagin Azhagu",
            "artist": "Sinduri Vishal",
            "album": "Sita Ramam (Tamil) (Extended Version) [Original Motion Picture Soundtrack]",
            "language": "Tamil",
            "cover": "https://coverartarchive.org/release/9b7594dc-ea6d-4e11-bcf1-f8b7d178021b/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Azhagin-Azhagu Sita Ramam.mp3"
        },
        {
            "title": "Chuttamalle",
            "artist": "Shilpa Rao",
            "album": "Devara Part 1",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/dc6f2139-159d-42be-a97a-1688ebc09e43/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Chuttamalle.mp3"
        },
        {
            "title": "Hey Minnale",
            "artist": "Haricharan",
            "album": "Amaran",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/fc13bea1-b6f3-446c-a3b4-fb9722ec87d6/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Hey Minnale.mp3"
        },
        {
            "title": "Hey Sita Hey Rama",
            "artist": "S.P.B. Charan",
            "album": "Sita Ramam (Tamil) (Extended Version) [Original Motion Picture Soundtrack]",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/9b7594dc-ea6d-4e11-bcf1-f8b7d178021b/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Hey-Sita-Hey-Rama Sita Ramam.mp3"
        },
        {
            "title": "Hukum – Thalaivar Alappara",
            "artist": "Anirudh Ravichander",
            "album": "Jailer",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/275532ec-0908-4caa-9448-1cffd293af56/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Hukum---Thalaivar-Alappara-MassTamilan.dev.mp3"
        },
        {
            "title": "Skyfall (From ''James Bond - Skyfall'')",
            "artist": "L’Orchestra Cinematique",
            "album": "The Greatest Hits of L'Orchestra Cinematique, Vol. 1",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/6484fb5d-0a28-456e-b7fb-f85cce0176d4/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/James Bond - Skyfall.mp3"
        },
        {
            "title": "Kaalangal Thaandi",
            "artist": "Sinduri Vishal",
            "album": "Sita Ramam (Tamil) (Extended Version) [Original Motion Picture Soundtrack]",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/9b7594dc-ea6d-4e11-bcf1-f8b7d178021b/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Kaalangal-Thaandi Sita Ramam.mp3"
        },
        {
            "title": "Kannukkulle",
            "artist": "Vishal Chandrasekhar",
            "album": "Sita Ramam (Extended Version)",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/ec71f732-357b-46f2-8dfb-70a566f90376/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Kannukkulle Sita Ramam.mp3"
        },
        {
            "title": "Kurchi Madathapetti",
            "artist": "Thaman S",
            "album": "Guntur Kaaram",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/8513347a-e591-42b3-bf79-da6a1b96dc4a/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Kurchi Madathapetti.mp3"
        },
        {
            "title": "Kurukku Paathaiyile",
            "artist": "S. P. Balasubrahmanyam",
            "album": "I Love India",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/9ea56bdc-00de-45cd-985a-38bd38089048/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Kurukku-Siruthavale.mp3"
        },
        {
            "title": "Kurumugil",
            "artist": "Vishal Chandrasekhar",
            "album": "Sita Ramam (Extended Version)",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/ec71f732-357b-46f2-8dfb-70a566f90376/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Kurumugil Sita Ramam.mp3"
        },
        {
            "title": "Kurunchiragu",
            "artist": "Vishal Chandrasekhar",
            "album": "Sita Ramam (Tamil) (Extended Version) [Original Motion Picture Soundtrack]",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/9b7594dc-ea6d-4e11-bcf1-f8b7d178021b/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Kurunchiragu Sita Ramam.mp3"
        },
        {
            "title": "Nannare",
            "artist": "Shreya Ghoshal",
            "album": "Guru",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/5fbe674d-0906-40f2-bbcb-ad9c619ffc13/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Nannare-Nannare.mp3"
        },
        {
            "title": "On & On",
            "artist": "Cartoon",
            "album": "Más Y Más / On & On",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/c332076d-f074-4679-9d05-e3eb6822d6a8/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/On & On (Cartoon).mp3"
        },
        {
            "title": "Piriyadhey",
            "artist": "Vishal Chandrasekhar",
            "album": "Sita Ramam (Tamil) (Extended Version) [Original Motion Picture Soundtrack]",
            "language": "Unknown",
            "cover": "https://coverartarchive.org/release/9b7594dc-ea6d-4e11-bcf1-f8b7d178021b/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Piriyadhey Sita Ramam.mp3"
        },
        {
            "title": "Sita Ramam Theme (Tamil)",
            "artist": "Vishal Chandrasekhar",
            "album": "Sita Ramam (Tamil) (Extended Version) [Original Motion Picture Soundtrack]",
            "language": "Tamil",
            "cover": "https://coverartarchive.org/release/9b7594dc-ea6d-4e11-bcf1-f8b7d178021b/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Sita-Ramam-Theme-(Tamil)-MassTamilan.dev.mp3"
        },
        {
            "title": "Cradles",
            "artist": "Sub Urban",
            "album": "Cradles",
            "language": "English",
            "cover": "https://coverartarchive.org/release/49d4417b-ff36-47c6-b3b4-315737377d86/front",
            "url": "https://raw.github.com/anyosil/symmusic.github.io/main/music/M1/Sub Urban - Cradles.mp3"
        },
    ],
    "nice": [
        { "title": "Regional Hit", "artist": "Singer X", "cover": "path/to/image.jpg", "url": "path/to/song" }
    ],
    "m_l": [
        { "title": "Rock Album 1", "artist": "Rock Band", "cover": "path/to/rock1.jpg", "url": "path/to/rock1" },
        { "title": "Rock Album 2", "artist": "Rock Star", "cover": "path/to/rock2.jpg", "url": "path/to/rock2" }
    ],
    "featured": [
        { "title": "Top Hit 1", "artist": "Famous Artist", "cover": "path/to/hit1.jpg", "url": "path/to/hit1" },
        { "title": "Top Hit 2", "artist": "Superstar", "cover": "path/to/hit2.jpg", "url": "path/to/hit2" }
    ]
};

// Function to create an album tile in Ovi Store format
function createAlbumTile(album) {
    return `
        <li>
            <ul>
                <li>
                    <a href="${album.url}" title="${album.title}">
                        <img src="${album.cover}" alt="" class="prod-med"/>
                    </a>
                    <span class="item">
                        <a href="${album.url}" title="${album.title}">${album.title}</a>
                    </span>
                    <a href="#" title="${album.artist}" class="inactive-lnk" onclick="return false">${album.artist}</a>
                </li>
            </ul>
        </li>
    `;
}

// Function to load albums into sections
function loadAlbums() {
    var sections = {
        "top": document.querySelector("#top ul"),
        "nice": document.querySelector("#nice ul"),
        "m_l": document.querySelector("#m_l ul"),
        "featured": document.querySelector("#featured ul")
    };

    Object.keys(database).forEach(category => {
        var section = sections[category];
        if (section) {
            section.innerHTML = database[category].map(createAlbumTile).join('');
        }
    });
}

document.addEventListener("DOMContentLoaded", function () {
    const miniPlayer = document.getElementById("miniPlayer");
    const miniTitle = document.getElementById("miniTitle");
    const miniArtist = document.getElementById("miniArtist");
    const miniCover = document.getElementById("miniCover");
    const miniAudio = document.getElementById("miniAudio");
    const closeMiniPlayer = document.getElementById("closeMiniPlayer");

    // Attach event listeners to all song links
    document.querySelectorAll(".song-link").forEach(link => {
        link.addEventListener("click", function (event) {
            event.preventDefault(); // Stop download

            let songUrl = this.getAttribute("href");
            let songData = findSongInDatabase(songUrl);

            if (!songData) {
                console.warn("Song not found in database:", songUrl);
                return;
            }

            // Update mini player with song details
            miniTitle.textContent = songData.title || "Unknown Title";
            miniArtist.textContent = songData.artist || "Unknown Artist";
            miniCover.src = songData.cover || "default-cover.jpg";
            miniAudio.src = songUrl;
            miniPlayer.classList.remove("hidden");

            // Play song
            miniAudio.play();
        });
    });

    // Close button
    closeMiniPlayer.addEventListener("click", function () {
        miniPlayer.classList.add("hidden");
        miniAudio.pause();
    });

    // Function to find song in database
    function findSongInDatabase(url) {
        for (let category in database) {
            let song = database[category].find(item => item.url === url);
            if (song) return song;
        }
        return null; // Not found
    }
});


document.querySelectorAll("a").forEach(link => {
    let originalUrl = link.href;

    // Check if the URL is prefixed with Wayback Machine's domain
    if (originalUrl.startsWith("https://web.archive.org/web/")) {
        // Extract the actual URL after the Wayback Machine prefix
        let cleanedUrl = originalUrl.replace(/https:\/\/web\.archive\.org\/web\/\d+\//, '');

        // Set the cleaned URL back
        link.href = cleanedUrl;
    }
});


// Function to switch tabs
function showTab(tabID) {
    var allSections = document.querySelectorAll(".scrollPanel");
    allSections.forEach(section => section.style.display = "none"); // Hide all

    var activeSection = document.getElementById(tabID);
    if (activeSection) activeSection.style.display = "block"; // Show selected
}

document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("a").forEach(link => {
        let originalUrl = link.href;

        if (originalUrl.includes("web.archive.org/web/")) {
            // Extract the real URL by removing the Wayback prefix
            let cleanedUrl = originalUrl.replace(/https:\/\/web\.archive\.org\/web\/\d+\//, "");

            // Forcefully override any hijacked links
            link.href = cleanedUrl;
            link.setAttribute("data-fixed", "true"); // Just to mark it's fixed
        }
    });

    // Extra Protection: Stop Wayback from injecting back in
    setInterval(() => {
        document.querySelectorAll("a").forEach(link => {
            if (link.href.includes("web.archive.org/web/")) {
                link.href = link.href.replace(/https:\/\/web\.archive\.org\/web\/\d+\//, "");
            }
        });
    }, 500); // Runs every 500ms to keep checking
});

document.addEventListener("click", function (event) {
    let target = event.target.closest("a"); // Check if a link was clicked
    if (target && target.href.includes("web.archive.org/web/")) {
        event.preventDefault(); // Stop default action
        let cleanedUrl = target.href.replace(/https:\/\/web\.archive\.org\/web\/\d+\//, "");
        window.location.href = cleanedUrl; // Redirect manually
    }
});

document.addEventListener("DOMContentLoaded", function () {
    function fixWaybackLinks() {
        document.querySelectorAll("a").forEach(link => {
            if (link.href.includes("web.archive.org/web/")) {
                link.href = link.href.replace(/https:\/\/web\.archive\.org\/web\/\d+\//, "");
            }
        });
    }

    // Run fix on page load
    fixWaybackLinks();

    // Watch for new elements being added (Wayback reinjects links dynamically)
    const observer = new MutationObserver(fixWaybackLinks);
    observer.observe(document.body, { childList: true, subtree: true });

    // Block clicks that still contain Wayback URLs
    document.addEventListener("click", function (event) {
        let target = event.target.closest("a");
        if (target && target.href.includes("web.archive.org/web/")) {
            event.preventDefault(); // Stop default action
            let cleanedUrl = target.href.replace(/https:\/\/web\.archive\.org\/web\/\d+\//, "");
            window.location.href = cleanedUrl; // Redirect manually
        }
    });
});

(function () {
    function cleanWaybackLinks() {
        document.querySelectorAll("a").forEach(link => {
            if (link.href.includes("web.archive.org/web/")) {
                let cleanedUrl = link.href.replace(/https:\/\/web\.archive\.org\/web\/\d+\//, "");
                link.setAttribute("href", cleanedUrl);
            }
        });
    }

    // 1️⃣ Block Wayback at the document level (injected early)
    Object.defineProperty(document, 'URL', {
        get: function () {
            return window.location.href.replace(/https:\/\/web\.archive\.org\/web\/\d+\//, "");
        }
    });

    // 2️⃣ Override any future changes to links
    const observer = new MutationObserver(cleanWaybackLinks);
    observer.observe(document.body, { childList: true, subtree: true });

    // 3️⃣ Intercept and fix links before navigation happens
    document.addEventListener("click", function (event) {
        let target = event.target.closest("a");
        if (target && target.href.includes("web.archive.org/web/")) {
            event.preventDefault();
            let cleanedUrl = target.href.replace(/https:\/\/web\.archive\.org\/web\/\d+\//, "");
            window.location.href = cleanedUrl;
        }
    });

    // Run cleanup immediately
    cleanWaybackLinks();
})();


document.addEventListener("DOMContentLoaded", loadAlbums);
